# Registration

Endpoints used for registaring new user into the system.

## New user

```shell
curl "https://example.com/api/v1/register" \
  -X POST \
  -H "Content-Type: application/json" \
  -d '{ ... }'
```

```swift
let request = URLRequest.shared
request.post()
```

> Example request body:

```json
{
  "userName": "johndoe",
  "email": "johndoe@email.com",
  "password": "P@ssword1!",
  "redirectBaseUrl": "https://example.com",
  "agreement": true,
  "name": "John Doe",
  "bio": "I'm a photographer...",
  "securityToken": "435nkerguh8734bwbrg",
  "locale": "en_US",
  "reason": "I would like to share with you my photos...",
  "inviteToken": "34egdfert9fyg7d8fbt9sd"
}
```

> Example response body (200 OK):

```json
{
  "id": "7243149752689283073",
  "userName": "johndoe",
  "account": "johndoe@example.com",
  "email": "johndoe@email.com",
  "name": "John Doe",
  "bio": "I'm a photographer...",
  "avatarUrl": "https://example.com/storage/454kwffvsr453sdfsd2345wevsdf.jpg"
}
```

> Example response body (field validation):

```json
{
    "code": "validationError",
    "reason": "Validation errors occurs.",
    "failures": [
        {
            "field": "email",
            "failure": "is not a valid email address"
        },
        {
            "field": "redirectBaseUrl",
            "failure": "is an invalid URL"
        }
    ],
    "error": true
}
```

> Example response body (business logic validation):

```json
{
  "code": "userNameIsAlreadyTaken",
  "reason": "User with provided user name already exists in the system."
}
```

Create a new user account in the system. After registration, the user can use the system, but until he confirms his e-mail address,
access is limited. For example, the user cannot add new statuses. It is also recommended to configure `reCaptcha`,
which will prevent bots from creating accounts.

During account creation process server will send to the user inbox email with information how to confirm his email address.
In the email there will be link with address to the client application (from `redirectBaseUrl`). Client application should
serve the page will can retrieve two parameters:

 - `token` - string, GUID
 - `userId` - new user identifier
 
 Client application have to read that parameters and use endpoint `POST /api/v1/account/email/confirm` to confirm the email.

### HTTP Request

`POST https://example.com/api/v1/register`

### Request properties

Property        | Type           | Description
----------------|----------------|--------------
userName        | string(1...50) | User name of the new user. <br /> **required**
email           | string         | Email address of the new user. <br /> **format:** email <br /> **required**
password        | string(8...32) | Password for the new account. At least one lowercase letter, one uppercase letter, number or symbol. <br /> **format:** password <br /> **required** 
redirectBaseUrl | string         | Base url to web application. It's used to redirect from email about email confirmation to correct web application page. <br /> **format:** url <br /> **required**
agreement       | bool           | Information if user accepted the server rules. Only request with `true` as a value can be procesed. <br /> **required**
name            | string(...100) | Full name of the user. <br /> **optional**
bio             | string(...500) | Short information about the user. <br /> **optional**
securityToken   | string(0...)   | Token generated by `reCaptcha` <br /> **required** (can be empty)
locale          | string(5)      | Locale with format like: `en_US`, `en_GB`, `pl_PL` etc. This will be used to prepare email for confirmation email message. <br /> **optional**
reason          | string(...500) | When registartion by moderator approval is enabled (and open registration is disabled) user have to write reason why account for him should be created <br /> **optional**
inviteToken     | string         | When registration by invitation is enabled (and open registration is disabled) the invitation token have to be specified <br /> **optional** 

### Response properties

Property  | Type | Description
----------|----------------|------
id        | string(20)     | New user identifier.
userName  | string(1...50) | User name created by the user.
account   | string         | Account create by concatenate `userName` and the `domain` of the server (used in ActivityPub).
email     | string         | User email.
name      | string(...100) | User full name.
bio       | string(...500) | Short information about the user.
avatarUrl | string         | Url to the new user avatar. Avatar is downloaded from `Gravatar` service based on user email. When user doesn't have avatar in that service default avatar is used.

### Errors

Status | Code                         | Reason
-------|------------------------------|-----------
400    | validationError              | Validation errors occurs.
400    | securityTokenIsMandatory     | Security token is mandatory (it should be provided from Google reCaptcha).
400    | securityTokenIsInvalid       | Security token is invalid (Google reCaptcha API returned that information).
400    | userNameIsAlreadyTaken       | User with provided user name already exists in the system.
400    | emailIsAlreadyConnected      | Email is already connected with other account.
400    | missingEmail                 | Email has not been specified but it's mandatory.
400    | missingEmailConfirmationGuid | Email confirmation guid has not been generated.
403    | registrationIsDisabled       | Registration is disabled.
403    | userHaveToAcceptAgreeent     | User have to accept agreement.
403    | reasonIsMandatory            | Reason is mandatory when only registration by approval is enabled.
403    | invitationTokenIsInvalid     | Invitation token is invalid.
403    | invitationTokenHasBeenUsed   | Invitation token has been used.
500    | userIdNotExists              | User Id not exists. Probably saving of the user entity failed.

<aside class="success">
Remember â€” a happy kitten is an authenticated kitten!
</aside>

## Username

```shell
curl "https://example.com/api/v1/register/username/@username" \
  -X GET \
  -H "Content-Type: application/json"
```

```swift
let request = URLRequest.shared
request.post()
```

> Example response body (200 OK):

```json
{
  "result": true
}
```

Information about user name availability. Endpoint can be used on registration screen to show very fast information to the user.

## Email

```shell
curl "https://example.com/api/v1/register/email/johndoe@example.com" \
  -X GET \
  -H "Content-Type: application/json"
```

```swift
let request = URLRequest.shared
request.post()
```

> Example response body (200 OK):

```json
{
  "result": true
}
```

Information about email availability. Endpoint can be used on registration screen to show very fast information to the user.
